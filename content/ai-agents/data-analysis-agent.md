---
title: "データ分析エージェント"
tags: [基礎, 全章, 設計, ワークフロー, ツール, 実行環境, パターン, 品質, 構成要素, 安全性]
created: 2026-02-25
updated: 2026-02-25
---

## データ分析業務の課題とエージェントの適用

データ分析業務では、BIツールの操作スキルが必要、複雑な分析はSQLやPythonの知識が要求される、分析の仮説構築に時間がかかるといった課題があります。[[AIエージェント]]は自然言語の指示からPythonコードを生成・実行し、結果を解釈してレポートを作成します。具体的な製品としては、OpenAIのAdvanced Data Analysis（旧Code Interpreter）、各社のBI AIアシスタントなどがあります。エージェントの設計では、[[シングルエージェントワークフロー]]が基本で、コード生成→実行→結果検証のサイクルを繰り返します。

## コード生成・実行・リフレクション

データ分析エージェントの中核は3つのステップのサイクルです。(1)コード生成：データの概要と分析目的をLLMに伝え、Pythonコード（pandas、matplotlib等）を生成。(2)コード実行：生成コードを[[E2B]]等のサンドボックス環境で実行。ホストシステムへの影響を隔離しつつ、ライブラリの利用やファイル操作を可能にする。(3)[[リフレクション]]：実行結果（出力、エラー、グラフ）をLLMに返し、コードの問題点を分析させて修正コードを生成。このサイクルを成功するまで繰り返します。[[Code Interpreter]]はこの一連のプロセスを統合的に提供する仕組みです。

## 分析レポートの作成

単発のコード実行を超えて、構造化された分析レポートを作成するには計画が必要です。(1)計画立案（仮説構築）：データの概要を分析し、「売上の季節変動パターンの特定」「顧客セグメントごとの購買傾向」等の分析仮説を生成。(2)仮説ごとのコード生成・実行：各仮説を検証するPythonコードを生成・実行し、グラフや統計結果を取得。(3)レポート生成：全ての実行結果を統合し、発見事項・考察・推奨アクションを含むMarkdownレポートを生成。この構造により、単なる集計を超えた洞察を提供できます。

## 課題と展望

データ分析エージェントの課題として、(1)データの前処理（欠損値処理、型変換）で予期しないエラーが発生しやすい、(2)生成されたグラフの解釈が浅い場合がある（相関と因果の混同等）、(3)大規模データではコード実行のリソース管理が必要。改善の方向性として、ドメイン知識をプロンプトに組み込むこと、分析パターンのテンプレート化、[[ヒューマンインザループ]]で分析の方向性を人間が確認することが有効です。将来的にはマルチモーダル（グラフの画像を直接AIが解釈）や、複数データソースを横断する分析への発展が期待されます。

## 用語

- **AI Agent（AIエージェント）**: LLMを頭脳として、外部ツールの利用・計画の立案・自己修正を自律的に行い、与えられた目標を達成するソフトウェアシステム。単なるチャットボットと異なり、環境を認識し、判断し、行動するループを持つ。
- **Single-Agent Workflow（シングルエージェントワークフロー）**: 1つのエージェントが全ての処理を担当するワークフロー。シンプルで管理しやすいが、複雑なタスクでは限界がある。コード生成→実行→リフレクションのサイクルが典型例。
- **E2B (Code Sandbox)（E2B（コードサンドボックス））**: AIが生成したコードを安全に実行するためのクラウドサンドボックス環境。ホストシステムから隔離された環境でコードを実行し、結果を取得する。データ分析エージェントでの活用が代表的。
- **Reflection（リフレクション）**: エージェントが自身の出力を振り返り、品質を評価・改善するプロセス。コード生成後にエラーを検出して修正する、回答の正確性を自己チェックするなど。自己修正の具体的な実装手法の一つ。
- **Code Interpreter（コードインタープリタ）**: AIが生成したプログラムコードをサンドボックス環境で実行し、結果を取得する仕組み。データ分析、数値計算、ファイル変換など、LLMの計算能力を補完するツールとして使われる。
- **Planning（計画（プランニング））**: エージェントが目標達成のために、タスクを分解し実行順序を決定するプロセス。計画の質がエージェント全体の成否を左右する。事前計画と動的再計画の2種類がある。
- **Human-in-the-Loop（ヒューマンインザループ）**: エージェントの処理フローに人間の判断・承認ポイントを組み込む設計パターン。重要な意思決定や不可逆な操作の前に人間の確認を挟むことで、エージェントの安全性と信頼性を確保する。
